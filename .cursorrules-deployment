# Cursor/Claude Code - Deployment Rules for LoopJS

## Deployment Configuration

### Render Backend Deployment
- API Key: Set in environment as `RENDER_API_KEY`
- MongoDB URI: Pre-configured in deployment scripts
- Region: Oregon (US West)
- Plan: Free tier

### Vercel Frontend Deployment
- Uses Vercel CLI (login required on first use)
- Auto-detects Vite framework
- Build output: `frontend/dist`

## Quick Commands

### From project root:

```bash
# Setup deployment tools
./setup-deployment.sh

# Check Render API and show deployment steps
node deploy-render.js

# Deploy frontend to Vercel (requires backend URL)
./deploy-vercel.sh https://your-backend.onrender.com
```

### From backend directory:

```bash
# Check Render deployment status
npm run deploy:render
```

## Environment Variables

### Render (Backend)
- `NODE_ENV=production`
- `PORT=10000`
- `MONGODB_URI` (from .env.deployment)
- `JWT_SECRET` (auto-generated by Render)
- `SESSION_SECRET` (auto-generated by Render)
- `ALLOWED_ORIGINS` (update after Vercel deployment)

### Vercel (Frontend)
- `VITE_API_URL` (Render backend URL + /api)
- `VITE_WS_URL` (Render backend WebSocket URL)
- `VITE_USE_LOCAL=false`

## Deployment Flow

1. **Deploy Backend to Render:**
   - Option A: Dashboard → New + → Blueprint (auto-detects render.yaml)
   - Option B: Run `node deploy-render.js` for API-based deployment
   - Option C: Manual web service creation

2. **Get Backend URL:**
   - Copy from Render dashboard: `https://SERVICE-NAME.onrender.com`

3. **Deploy Frontend to Vercel:**
   ```bash
   ./deploy-vercel.sh https://YOUR-BACKEND.onrender.com
   ```

4. **Update CORS:**
   - Add Vercel URL to Render environment variable `ALLOWED_ORIGINS`

5. **Test:**
   - Visit Vercel URL
   - Check health: `curl https://YOUR-BACKEND.onrender.com/health`

## Files Created

- `deploy-render.js` - Render API deployment script
- `deploy-vercel.sh` - Vercel CLI deployment script
- `setup-deployment.sh` - Setup script for CLI tools
- `.env.deployment` - Deployment secrets (NOT committed)
- `backend/render.yaml` - Render Blueprint configuration
- `frontend/vercel.json` - Vercel configuration

## Security

- Never commit `.env.deployment`
- API keys stored in environment variables
- MongoDB connection string URL-encoded
- CORS configured for specific domains

## MCP Integration

Currently using CLI tools and API scripts. Future: Custom MCP servers for Render/Vercel.

For MCP configuration, see: `~/.config/windsurf/User/mcp.json`
